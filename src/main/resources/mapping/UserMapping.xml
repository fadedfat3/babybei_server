<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhumingbei.babybei_server.mapper.UserMapper">
    <resultMap id="UserMap" type="com.zhumingbei.babybei_server.entity.User">
        <id property="userId" column="user_id"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="lastPasswordChanged" column="last_password_changed"/>
        <collection property="roles" ofType="com.zhumingbei.babybei_server.entity.Role">
            <id property="roleId" column="role_id"/>
            <result property="roleName" column="role_name"/>
        </collection>
        <collection property="permissions" ofType="com.zhumingbei.babybei_server.entity.Permission">
            <id property="permissionId" column="permission_id"/>
            <result property="permissionName" column="permission_name"/>
            <result property="exprission" column="exprission"/>
            <result property="url" column="url"/>
        </collection>
    </resultMap>
    <select id="getUserByName" resultMap="UserMap">
        select  user.user_id, username, password, last_password_changed,  role.role_id, role_name, permission.permission_id, permission_name, url, exprission
        from user
        left join user_role on user.user_id = user_role.user_id
        left join role on role.role_id = user_role.role_id
        left join role_permission on role_permission.role_id = role.role_id
        left join permission on permission.permission_id = role_permission.permission_id
        where username = #{username};
    </select>

    <select id="getList" resultMap="UserMap">
        select  user.user_id, username, password, last_password_changed,  role.role_id, role_name, permission.permission_id, permission_name, url, exprission
        from user
        left join user_role on user.user_id = user_role.user_id
        left join role on role.role_id = user_role.role_id
        left join role_permission on role_permission.role_id = role.role_id
        left join permission on permission.permission_id = role_permission.permission_id;
    </select>

    <insert id="insert">
        insert into user(username, password) value (#{username}, #{password});
    </insert>
</mapper>